<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Frame Game</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <!-- Добавляем поддержку VR -->
  <script src="https://unpkg.com/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
</head>
<body>
  <!-- Отключаем гравитацию -->
  <a-scene physics="debug: true; gravity: 0" vr-mode-ui="enabled: true">
    
    <!-- Небо и пол -->
    <a-sky color="#87CEEB"></a-sky>
    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" color="#228B22" static-body></a-plane>
    <!-- Эффекты -->
    <a-entity id="explosion" particle-system="preset: explosion; color: yellow" position="0 -10 0"></a-entity>
    <a-sound id="collectSound" src="yoursound.wav" autoplay="false"></a-sound>
    <!-- Камера с VR контроллерами -->
    <a-entity id="player" position="0 1.6 5" movement-controls="speed: 0.1">
      <a-entity camera look-controls wasd-controls="fly: false">
        <a-entity cursor="fuse: true; fuseTimeout: 500" raycaster="objects: .collectible"></a-entity>
      </a-entity>
      <!-- VR контроллеры -->
      <a-entity laser-controls="hand: right" raycaster="objects: .collectible"></a-entity>
      <a-entity laser-controls="hand: left" raycaster="objects: .collectible"></a-entity>
    </a-entity>
    <!-- Двигающийся объект без гравитации -->
    <a-entity id="movingObj" geometry="primitive: cone" material="color: red"
              position="0 2 -8" dynamic-body
              animation="property: position; to: 5 2 -8; dur: 2000; loop: true">
    </a-entity>
    <!-- Коллекционные объекты без гравитации -->
    <a-entity id="item1" class="collectible" geometry="primitive: box" material="color: blue" dynamic-body></a-entity>
    <a-entity id="item2" class="collectible" geometry="primitive: sphere" material="color: green" dynamic-body></a-entity>
    <a-entity id="item3" class="collectible" geometry="primitive: cylinder" material="color: yellow" dynamic-body></a-entity>
    <!-- Очки и таймер -->
    <a-text id="score" value="Score: 0" position="-1 3 -5" color="#000"></a-text>
    <a-text id="timer" value="Time: 60" position="1 3 -5" color="#000"></a-text>
  </a-scene>
  <script>
    // Инициализация физики без гравитации
    AFRAME.registerSystem('physics', {
      schema: {
        gravity: {default: 0} // Устанавливаем гравитацию в 0
      }
    });
    // Движение персонажа (обновленная версия)
    AFRAME.registerComponent('movement-controls', {
      schema: {speed: {default: 0.1}},
      init: function () {
        this.direction = new THREE.Vector3();
        this.keys = {};
        window.addEventListener('keydown', (e) => this.keys[e.code] = true);
        window.addEventListener('keyup', (e) => this.keys[e.code] = false);
      },
      tick: function () {
        const camera = this.el.querySelector('[camera]');
        camera.object3D.getWorldDirection(this.direction);
        this.direction.y = 0;
        const currentPos = this.el.object3D.position;
        const speed = this.data.speed;
        if (this.keys['KeyW']) {
          currentPos.add(this.direction.multiplyScalar(speed));
        }
        if (this.keys['KeyS']) {
          currentPos.add(this.direction.multiplyScalar(-speed));
        }
      }
    });
    // Спавн объектов с случайными позициями
    function spawnObjects() {
      const positions = [];
      for (let i = 0; i < 3; i++) {
        const x = Math.random() * 10 - 5;
        const z = Math.random() * 10 - 5;
        positions.push({x, y: 1, z}); // Спавн на одном уровне
      }
      document.getElementById('item1').setAttribute('position', positions[0]);
      document.getElementById('item2').setAttribute('position', positions[1]);
      document.getElementById('item3').setAttribute('position', positions[2]);
    }
    // Обработка сбора объектов
    AFRAME.registerComponent('collectible', {
      init: function () {
        this.el.addEventListener('collide', (e) => {
          if (e.detail.body.el.id === 'player' && !this.collected) {
            this.collected = true;
            this.el.setAttribute('visible', false);
            
            // Эффекты
            document.getElementById('explosion').setAttribute('position', this.el.object3D.position);
            document.getElementById('collectSound').components.sound.playSound();
            score++;
            document.getElementById('score').setAttribute('value', `Score: ${score}`);
            if (score === totalCollectibles) restartGame();
          }
        });
      }
    });
    // Переменные игры
    let score = 0;
    let time = 60;
    const totalCollectibles = 3;
    // Таймер
    const timer = setInterval(() => {
      if (time-- > 0) {
        document.getElementById('timer').setAttribute('value', `Time: ${time}`);
      } else {
        clearInterval(timer);
        restartGame();
      }
    }, 1000);
    // Перезапуск игры
    function restartGame() {
      score = 0;
      time = 60;
      document.getElementById('score').
