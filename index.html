<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Frame Game</title>
  
  <!-- Подключение A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <!-- Подключение физического движка -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
  <a-scene physics="debug: true">
    
    <!-- Небо и пол -->
    <a-sky color="#87CEEB"></a-sky>
    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" color="#228B22" static-body></a-plane>

    <!-- Камера с исправленным движением -->
    <a-entity id="player" position="0 1.6 5" player-movement>
      <a-entity camera look-controls></a-entity>
    </a-entity>

  </a-scene>

  <script>
    AFRAME.registerComponent('player-movement', {
      schema: { speed: { type: 'number', default: 0.1 } },

      init: function () {
        this.direction = new THREE.Vector3();
        this.rotation = new THREE.Euler();
        this.velocity = new THREE.Vector3();

        window.addEventListener('keydown', (event) => this.onKeyDown(event));
        window.addEventListener('keyup', (event) => this.onKeyUp(event));

        this.keys = { w: false, a: false, s: false, d: false };
      },

      onKeyDown: function (event) {
        const key = event.key.toLowerCase();
        if (this.keys.hasOwnProperty(key)) this.keys[key] = true;
      },

      onKeyUp: function (event) {
        const key = event.key.toLowerCase();
        if (this.keys.hasOwnProperty(key)) this.keys[key] = false;
      },

      tick: function () {
        const camera = this.el.children[0].object3D;
        camera.getWorldDirection(this.direction);
        this.direction.y = 0; // Игнорируем наклон вверх-вниз
        this.direction.normalize();

        this.velocity.set(0, 0, 0);

        if (this.keys.w) this.velocity.add(this.direction.clone().multiplyScalar(this.data.speed));
        if (this.keys.s) this.velocity.add(this.direction.clone().multiplyScalar(-this.data.speed));

        const leftDirection = new THREE.Vector3(-this.direction.z, 0, this.direction.x);
        if (this.keys.a) this.velocity.add(leftDirection.clone().multiplyScalar(this.data.speed));
        if (this.keys.d) this.velocity.add(leftDirection.clone().multiplyScalar(-this.data.speed));

        const position = this.el.object3D.position;
        position.add(this.velocity);
      }
    });
  </script>
</body>
</html>
