<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Frame Collision Game</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <!-- Небо и пол -->
    <a-sky color="#87CEEB"></a-sky>
    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" color="#228B22"></a-plane>

    <!-- Камера с WASD и управлением мышью -->
    <a-entity 
      id="player" 
      position="0 1.6 5" 
      camera 
      wasd-controls 
      look-controls 
      collision-check>
    </a-entity>

    <!-- Объекты для сбора -->
    <a-sphere id="item1" position="0 1 -3" radius="0.5" color="#FF6347" collectible></a-sphere>
    <a-box id="item2" position="2 1 -5" depth="1" height="1" width="1" color="#FFD700" collectible></a-box>
    <a-sphere id="item3" position="-2 1 -4" radius="0.5" color="#1E90FF" collectible></a-sphere>
    <a-cylinder id="item4" position="3 1 -6" radius="0.5" height="1" color="#8A2BE2" collectible></a-cylinder>
    <a-box id="item5" position="-3 1 -7" depth="1" height="1" width="1" color="#00CED1" collectible></a-box>

    <!-- Счет и таймер -->
    <a-text id="score" value="Score: 0" position="-1 3 -5" color="#000"></a-text>
    <a-text id="timer" value="Time: 60" position="1 3 -5" color="#000"></a-text>
  </a-scene>

  <script>
    // Начальные значения
    let score = 0;
    let time = 60;
    let totalCollectibles = 5; // Общее количество объектов

    // 1. Создание компонента для сбора объектов
    AFRAME.registerComponent('collectible', {
      init: function () {
        this.el.classList.add('collectible'); // Добавляем класс для объекта
        this.collected = false; // Флаг, чтобы объект не обрабатывался повторно
      }
    });

    // 2. Добавление логики проверки столкновений
    AFRAME.registerComponent('collision-check', {
      tick: function () {
        const player = this.el;
        const collectibles = document.querySelectorAll('.collectible');

        collectibles.forEach((item) => {
          const playerPos = player.object3D.position;
          const itemPos = item.object3D.position;

          // Проверка расстояния между игроком и объектом
          const distance = playerPos.distanceTo(itemPos);
          if (distance < 1 && !item.collected) { // Если расстояние меньше 1 и объект еще не собран
            item.setAttribute('visible', false); // Объект исчезает
            item.collected = true; // Помечаем объект как собранный
            score++;
            document.getElementById('score').setAttribute('value', `Score: ${score}`);

            // Проверка, все ли объекты собраны
            if (score === totalCollectibles) {
              endGame('Victory! You collected all items!');
            }
          }
        });
      }
    });

    // 3. Создание таймера
    const timer = setInterval(() => {
      if (time > 0) {
        time--;
        document.getElementById('timer').setAttribute('value', `Time: ${time}`);
      } else {
        clearInterval(timer);
        endGame('Game Over! Time is up.');
      }
    }, 1000);

    // 4. Завершение игры
    function endGame(message) {
      alert(`${message}\nFinal Score: ${score}`);
      location.reload(); // Перезапуск игры
    }
  </script>
</body>
</html>
